\chapter{Introduction}\label{chap:introduction}

In an idealized perspective on computation, programs and their subcomponents are \emph{pure} functions. They take some input and for every set of inputs they return the same output, without interacting with other parts of the program or with the system. There is a certain elegance to this view: pure programs are relatively easy to reason about and analyse.

However, in practice, many programs are \emph{impure}. These programs might interact with memory and the network, write to and read from the terminal. Additionally, programs might be clearer when they can be expressed with more complex control flow structures like exceptions and coroutines. We call these extensions on top of pure computation \emph{effects} \autocite{moggi_computational_1989}.

Some programming languages, such as C and many of the languages it inspired, have opted to give the programmer unrestriced access to effectful operations. In particular, any part of the program can access memory, the filesystem and even allowed to use \el{goto} to jump to other parts outside of regular control flow. This unrestricted use has famously been criticized by \textcite{dijkstra_letters_1968} and others. An open challenge in language design is then to design a language which allows for (limited) impure calculation, while retaining the attractive qualities of pure languages.

A promising aproach to striking this balance is the framework of algebraic effects by \textcite{goos_adequacy_2001} and extended by \textcite{castagna_handlers_2009}. Here, algebraic effects are only allowed within \emph{handlers}, which have some, but still limited, control over the flow of the program via continuations. In recent years, some languages (e.g. Koka \autocite{leijen_type_2017}) have been created with support for algebraic effects. However, there are some common patterns of effects that cannot be represented as algebraic effects, namely higher-order effects, that is, effects whose operations that take effectful computations as arguments.

To overcome this limitation, \textcite{bach_poulsen_hefty_2023} have extended algebraic effects with \emph{hefty algebras}. They introduce \emph{elaborations} in addition to handlers, which can encode higher-order effects.

In this thesis, we build on the work by \textcite{bach_poulsen_hefty_2023}, applying the theory of hefty algebras as a first-class construct in a novel programming language called \emph{Elaine}. Like Koka and other languages with support for algebraic effects, Elaine supports handlers. In addition, elaborations and higher-order effects are also supported.

We provide a novel reduction semantics and type system for a language with supporting elaborations. Furthermore, we introduce two transformations on Elaine programs. The first transformation is a type directed inference of elaborations, allowing the names of elaborations in use to be omitted. The second is a transformation from a program with higher-order effects and elaborations to a program with only algebraic effects. This transformation shows that elaborations can be added to existing languages and libraries for effects with relative ease.

In addition, we provide a full implementation of this language\footnote{available at \url{https://github.com/tertsdiepraam/thesis/tree/main/elaine}}. This implementation includes a parser, type checker, pretty printer, type checker and the two transformations described in this thesis.
